<!DOCTYPE HTML>
<html lang="en">
<head>

<meta charset="utf-8">

<title>sap.ui.table - TreeTable with JSON</title>
<link rel="shortcut icon" type="image/x-icon" href="images/controls/sap.ui.table.TreeTable.gif">

<script src="shared-config.js"></script>
<script id="sap-ui-bootstrap"
		data-sap-ui-libs="sap.m,sap.ui.table,sap.ui.unified"
		src="../../../../resources/sap-ui-core.js"></script>

<script src="Settings.js"></script>

<script>
	/*global TABLESETTINGS */
	sap.ui.define([
		"sap/ui/table/library",
		"sap/ui/table/TreeTable",
		"sap/ui/table/Column",
		"sap/m/Button",
		"sap/m/CheckBox",
		"sap/m/ProgressIndicator",
		"sap/m/Text",
		"sap/m/Title",
		"sap/ui/table/utils/TableUtils",
		"sap/m/Toolbar",
		"sap/ui/model/json/JSONModel"
	], function(library, TreeTable, Column, Button, CheckBox, ProgressIndicator, Text, Title, TableUtils, Toolbar, JSONModel) {
		const SelectionMode = library.SelectionMode;

		new Button({
			text: "Just a Button before"
		}).placeAt("content");

		const oTable = new TreeTable({
			footer: "Footer of the Table",
			groupHeaderProperty: "name",
			selectionMode: SelectionMode.MultiToggle,
			extension: [
				new Title({
					text: "Title of the TreeTable"
				})
			],
			columns: [
				new Column(
						{label: "Name", template: new Text({text: "{name}", wrapping: false}), filterProperty: "name", sortProperty: "name"}),
				new Column({label: "Description", template: "description", sortProperty: "description"}),
				new Column({label: "Available", template: new CheckBox({selected: "{checked}"})}),
				new Column({label: "ProgressIndicator", template: new ProgressIndicator({
					displayValue: "50",
					percentValue: "10",
					showaValue: true,
					width: "100%"
				})})
			]
		});

		oTable.setToolbar(new Toolbar({
			content: [
				new sap.m.Button({
					text: "Expand",
					press: function() {
						var oSelectionPlugin = oTable._getSelectionPlugin();
						var iSelectedIndex = oSelectionPlugin.getSelectedIndex();
						oTable.expand(iSelectedIndex);
						oSelectionPlugin.setSelectedIndex(iSelectedIndex);
					}
				}),
				new Button({
					text: "Collapse",
					press: function() {
						var oSelectionPlugin = oTable._getSelectionPlugin();
						var iSelectedIndex = oSelectionPlugin.getSelectedIndex();
						oTable.collapse(iSelectedIndex);
						oSelectionPlugin.setSelectedIndex(iSelectedIndex);
					}
				})
			]
		}));

		oTable.attachToggleOpenState(function(oEvent) {
			jQuery.sap.log.info("ToggleOpenState: rowIndex: " + oEvent.getParameter("rowIndex") +
								" - rowContext: " + oEvent.getParameter("rowContext") +
								" - expanded? " + oEvent.getParameter("expanded"));
		});

		oTable.attachRowSelectionChange(function(oEvent) {
			jQuery.sap.log.info("RowSelectionChange: rowIndex: " + oEvent.getParameter("rowIndex") +
								" - rowContext: " + oEvent.getParameter("rowContext"));
		});

		// set Model and bind Table
		const oModel = new JSONModel();
		oModel.setData(TABLESETTINGS.treeTestData);
		oTable.setModel(oModel);
		oTable.bindRows({
			path: "/root",
			parameters: {
				numberOfExpandedLevels: 1
			}
		});


		oTable.placeAt("content");
		new Button({text: "Just a Button after"}).placeAt("content");

		TABLESETTINGS.init(oTable, function(oButton) {
			oTable.getToolbar().addContent(oButton);
		}, {
			FLATMODE: {
				text: "Flat Mode (protected)",
				value: function(oTable) {
					return TableUtils.Grouping.isInFlatMode(oTable);
				},
				input: "boolean",
				action: function(oTable, bValue) {
					oTable.setUseFlatMode(!!bValue);
				}
			}
		});
	});
</script>
</head>
<body class="sapUiBody sapUiSizeCozy">
<h1 id="header">Test Page for <code>sap.ui.table.TreeTable</code> with <code>sap.m</code> library</h1>
<div id="content"></div>
</body>
</html>